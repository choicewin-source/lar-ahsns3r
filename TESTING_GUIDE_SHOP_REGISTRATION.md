# ุฏููู ุงุฎุชุจุงุฑ ุชุณุฌูู ุงููุชุฌุฑ ๐ช

## ูุธุฑุฉ ุนุงูุฉ
ูุฐุง ุงูุฏููู ูุดุฑุญ ููููุฉ ุงูุชุญูู ูู ุฃู ูุธุงู ุชุณุฌูู ุงููุชุงุฌุฑ ูุนูู ุจุดูู ุตุญูุญุ ุจูุง ูู ุฐูู:
- โ ุชุณุฌูู ุงููุชุฌุฑ ุนุจุฑ ุงููููุฐุฌ ุงูุชูููุฏู
- โ ุชุณุฌูู ุงููุชุฌุฑ ุนุจุฑ ุญุณุงุจ Google
- โ ุฅุฑุณุงู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุฏูุฑูู
- โ ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชุฎุฏู

---

## ุงููุชุทูุจุงุช ุงูุฃูููุฉ

### 1. ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช Google OAuth

ุชุฃูุฏ ูู ุฃู ุงูููู `.env` ูุญุชูู ุนูู:

```env
GOOGLE_CLIENT_ID=57158123082-enckaf1upp8f58q8cttmi54fec49597o.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GOOGLE_REDIRECT_URL=http://localhost:8000/auth/google/callback
```

โ๏ธ **ููู**: ุชุฃูุฏ ูู ุฃู `GOOGLE_REDIRECT_URL` ูุทุงุจู URL ุงูุฐู ูุนูู ุนููู ุงูุชุทุจูู.

### 2. ุชุดุบูู Migrations

```bash
php artisan migrate
```

ุชุฃูุฏ ูู ุฃู ุฌุฏูู `users` ูุญุชูู ุนูู ุงูุญููู ุงูุชุงููุฉ:
- `google_id` (nullable)
- `avatar` (nullable)
- `shop_name` (nullable)
- `shop_city` (nullable)
- `shop_phone` (nullable)
- `is_approved` (boolean, default: false)
- `email_verified_at` (timestamp, nullable)

---

## ุทุฑู ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู Log Driver (ููุชุทููุฑ)

ูู ููู `.env`:
```env
MAIL_MAILER=log
```

**ููููุฉ ุงูุชุญูู:**
1. ุงูุชุญ ุงูููู: `storage/logs/laravel.log`
2. ุจุนุฏ ุชุณุฌูู ูุชุฌุฑ ุฌุฏูุฏุ ุณุชุฌุฏ ุฑุณุงูุฉ ุงูุจุฑูุฏ ูู ุงูููู
3. ุงุจุญุซ ุนู "ุทูุจ ุชุณุฌูู ูุชุฌุฑ ุฌุฏูุฏ"

---

### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู Mailtrap (ููุตู ุจูุง ููุชุทููุฑ)

**ุงูุฎุทูุงุช:**

1. **ุฅูุดุงุก ุญุณุงุจ ูุฌุงูู ุนูู Mailtrap:**
   - ุฒุฑ ุงููููุน: https://mailtrap.io
   - ุณุฌู ุญุณุงุจ ูุฌุงูู
   - ุงูุชูู ุฅูู "Email Testing" > "Inboxes"
   - ุงูุดุฆ Inbox ุฌุฏูุฏ ุฃู ุงุณุชุฎุฏู ุงูุงูุชุฑุงุถู

2. **ุงุญุตู ุนูู ุจูุงูุงุช SMTP:**
   - ุงุถุบุท ุนูู Inbox
   - ุงุฎุชุฑ ุชุจููุจ "SMTP Settings"
   - ุงุฎุชุฑ "Laravel 9+" ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   - ุงูุณุฎ ุงูุฅุนุฏุงุฏุงุช

3. **ุญุฏูุซ ููู `.env`:**
```env
MAIL_MAILER=smtp
MAIL_HOST=sandbox.smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_mailtrap_username
MAIL_PASSWORD=your_mailtrap_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="info@ahsansanar.com"
MAIL_FROM_NAME="ุฃุญุณู ุณุนุฑ"
```

4. **ุงูุณุญ ุงููุงุด:**
```bash
php artisan config:clear
php artisan cache:clear
```

**ููููุฉ ุงูุชุญูู:**
- ุจุนุฏ ุชุณุฌูู ูุชุฌุฑุ ุงูุชุญ Mailtrap Inbox
- ุณุชุธูุฑ ุงูุฑุณุงูุฉ ููุฑุงู
- ููููู ูุชุญูุง ููุฑุงุกุฉ ูุญุชูุงูุง

---

### ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู Gmail (ููุฅูุชุงุฌ)

โ๏ธ **ุชุญุฐูุฑ**: ูุฐู ุงูุทุฑููุฉ ููุฅูุชุงุฌ ููุทุ ุงุณุชุฎุฏู Mailtrap ููุชุทููุฑ

1. **ุฅูุดุงุก App Password ูู Gmail:**
   - ุงุฐูุจ ุฅูู: https://myaccount.google.com/security
   - ูุนูู "2-Step Verification" ุฅุฐุง ูู ููู ููุนูุงู
   - ุงุจุญุซ ุนู "App passwords"
   - ุฃูุดุฆ App Password ุฌุฏูุฏ ูุงุญูุธู

2. **ุญุฏูุซ ููู `.env`:**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your_email@gmail.com
MAIL_PASSWORD=your_app_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="your_email@gmail.com"
MAIL_FROM_NAME="ุฃุญุณู ุณุนุฑ"
```

---

## ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุณููุงุฑูู 1: ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ ุงููููุฐุฌ ุงูุชูููุฏู โ

**ุงูุฎุทูุงุช:**

1. ุงูุชุญ ุงููุชุตูุญ ูุงุฐูุจ ุฅูู: `http://localhost:8000/register-shop`

2. ุงููุฃ ุงููููุฐุฌ ุจุงูุจูุงูุงุช ุงูุชุงููุฉ:
   - **ุงูุงุณู ุงูุดุฎุตู**: ุฃุญูุฏ ูุญูุฏ
   - **ุงุณู ุงููุชุฌุฑ**: ูุนุฑุถ ุงูููุฑ ููุฅููุชุฑูููุงุช
   - **ุงููุฏููุฉ**: ูุฏููุฉ ุบุฒุฉ
   - **ุฑูู ุงููุงุชู**: 0591234567
   - **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: test-shop@example.com
   - **ูููุฉ ุงููุฑูุฑ**: Password123!
   - **ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ**: Password123!

3. ุงุถุบุท ุนูู ุฒุฑ "ุชุณุฌูู ุงููุชุฌุฑ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุชู ุชุญูููู ุฅูู ุตูุญุฉ "ุทูุจู ููุฏ ุงููุฑุงุฌุนุฉ" (`/register-pending`)
- โ ุชุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ: "ุชู ุชุณุฌูู ูุชุฌุฑู ุจูุฌุงุญ!"
- โ ุชุธูุฑ ูุนูููุงุช ุงููุชุฌุฑ ุงููุณุฌู
- โ ูุชู ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ูููุฏูุฑูู

**ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:**
- ุงูุชุญ Mailtrap ุฃู `storage/logs/laravel.log`
- ุงุจุญุซ ุนู ุฑุณุงูุฉ "ุทูุจ ุชุณุฌูู ูุชุฌุฑ ุฌุฏูุฏ"
- ุชุญูู ูู ูุฌูุฏ ูุนูููุงุช ุงููุชุฌุฑ ูู ุงูุฑุณุงูุฉ

**ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```bash
php artisan tinker
```
```php
$user = \App\Models\User::where('email', 'test-shop@example.com')->first();
echo "Name: " . $user->name . "\n";
echo "Shop Name: " . $user->shop_name . "\n";
echo "Role: " . $user->role . "\n";
echo "Is Approved: " . ($user->is_approved ? 'Yes' : 'No') . "\n";
echo "Email Verified: " . ($user->email_verified_at ? 'Yes' : 'No') . "\n";
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```
Name: ุฃุญูุฏ ูุญูุฏ
Shop Name: ูุนุฑุถ ุงูููุฑ ููุฅููุชุฑูููุงุช
Role: shop_owner
Is Approved: No
Email Verified: No
```

---

### ุงูุณููุงุฑูู 2: ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ Google โ

**ุงูุฎุทูุงุช:**

1. ุงูุชุญ ุงููุชุตูุญ ูุงุฐูุจ ุฅูู: `http://localhost:8000/register-shop`

2. ุงุถุบุท ุนูู ุฒุฑ "ุชุณุฌูู ุงููุชุฌุฑ ุจุงุณุชุฎุฏุงู Google"

3. ุณูุชู ุชุญูููู ุฅูู ุตูุญุฉ Google ูููุตุงุฏูุฉ

4. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ Google ุงูุฎุงุต ุจู

5. ูุงูู ุนูู ุงูุฃุฐููุงุช ุงููุทููุจุฉ

6. ุณูุชู ุชุญูููู ุฅูู ุตูุญุฉ "ุฃููู ุชุณุฌูู ูุชุฌุฑู"

7. ุงููุฃ ุงููุนูููุงุช ุงููุทููุจุฉ:
   - **ุงุณู ุงููุชุฌุฑ**: ูุนุฑุถ ุงูุชูููููุฌูุง ุงูุญุฏูุซุฉ
   - **ุงููุฏููุฉ**: ุฎุงููููุณ
   - **ุฑูู ุงููุงุชู**: 0599876543

8. ุงุถุบุท ุนูู "ุฅููุงู ุชุณุฌูู ุงููุชุฌุฑ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุชู ุชุญูููู ุฅูู ุตูุญุฉ "ุทูุจู ููุฏ ุงููุฑุงุฌุนุฉ"
- โ ุชุธูุฑ ุตูุฑุฉ ุญุณุงุจู ูู Google
- โ ูุชู ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ูููุฏูุฑูู

**ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```php
$user = \App\Models\User::where('shop_name', 'ูุนุฑุถ ุงูุชูููููุฌูุง ุงูุญุฏูุซุฉ')->first();
echo "Google ID: " . ($user->google_id ? 'Found' : 'Not Found') . "\n";
echo "Avatar: " . ($user->avatar ? 'Found' : 'Not Found') . "\n";
echo "Email Verified: " . ($user->email_verified_at ? 'Yes' : 'No') . "\n";
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
Google ID: Found
Avatar: Found
Email Verified: Yes  (ูุฃู Google ูุคูุฏ ุงูุจุฑูุฏ ุชููุงุฆูุงู)
```

---

### ุงูุณููุงุฑูู 3: ุงูุชุญูู ูู ุชุฃููุฏ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู โ๏ธ

**ููุงุญุธุฉ**: Laravel Breeze ูุฑุณู ุฑุณุงูุฉ ุชุฃููุฏ ุงูุจุฑูุฏ ุชููุงุฆูุงู ุนูุฏ ุงูุชุณุฌูู

**ุงูุฎุทูุงุช:**

1. ุจุนุฏ ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ ุงููููุฐุฌ ุงูุชูููุฏู
2. ุงูุชุญ Mailtrap ุฃู `storage/logs/laravel.log`
3. ุณุชุฌุฏ ุฑุณุงูุชูู:
   - **ูููุฏูุฑ**: "ุทูุจ ุชุณุฌูู ูุชุฌุฑ ุฌุฏูุฏ"
   - **ูููุณุชุฎุฏู**: "Verify Email Address"

**ุงูุชุญูู ูู ุฑุณุงูุฉ ุงูุชุฃููุฏ:**
- ุงูุชุญ ุงูุฑุณุงูุฉ ุงูููุฌูุฉ ูููุณุชุฎุฏู
- ูุฌุจ ุฃู ุชุญุชูู ุนูู ุฒุฑ "Verify Email Address"
- ุงูุฑุงุจุท ูุฌุจ ุฃู ูููู ุจุงูุดูู: `http://localhost:8000/verify-email/ID/HASH`

**ุงุฎุชุจุงุฑ ุงูุชุฃููุฏ:**
1. ุงูุณุฎ ุฑุงุจุท ุงูุชุฃููุฏ ูู ุงูุจุฑูุฏ
2. ุงูุชุญู ูู ุงููุชุตูุญ
3. ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ "Email Verified Successfully"

**ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```php
$user = \App\Models\User::where('email', 'test-shop@example.com')->first();
echo "Email Verified At: " . $user->email_verified_at . "\n";
```

---

### ุงูุณููุงุฑูู 4: ุงูุชุญูู ูู ุฅุดุนุงุฑ ุงููุฏูุฑูู ๐ง

**ุงูุฎุทูุงุช:**

1. ุชุฃูุฏ ูู ูุฌูุฏ ูุณุชุฎุฏู ุจุฏูุฑ Admin ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```bash
php artisan tinker
```
```php
$admin = \App\Models\User::where('role', 'admin')->first();
if (!$admin) {
    $admin = \App\Models\User::create([
        'name' => 'ุงููุฏูุฑ ุงูุนุงู',
        'email' => 'admin@ahsansanar.com',
        'password' => bcrypt('Admin123!'),
        'role' => 'admin',
        'is_approved' => true,
        'email_verified_at' => now(),
    ]);
    echo "Admin created!\n";
} else {
    echo "Admin exists: " . $admin->email . "\n";
}
```

2. ุณุฌู ูุชุฌุฑ ุฌุฏูุฏ

3. ุงูุชุญ Mailtrap ุฃู Laravel Log

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุฑุณุงูุฉ ุฅูู ุจุฑูุฏ ุงููุฏูุฑ ุชุญุชูู ุนูู:
  - ุงุณู ุงููุชุฌุฑ
  - ุงููุฏููุฉ
  - ุฑูู ุงููุงุชู
  - ุฒุฑ "ูุฑุงุฌุนุฉ ุงูุทูุจ" ูุคุฏู ุฅูู `/admin/dashboard`

**ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```php
$admin = \App\Models\User::where('role', 'admin')->first();
$notifications = $admin->notifications;
echo "Notifications count: " . $notifications->count() . "\n";
foreach ($notifications as $notification) {
    print_r($notification->data);
}
```

---

## ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง

### 1. ุงูุฎุทุฃ: "Google OAuth not configured"

**ุงูุญู:**
```bash
# ุชุฃูุฏ ูู ุฃู config/services.php ูุญุชูู ุนูู ุฅุนุฏุงุฏุงุช Google
php artisan config:clear
php artisan cache:clear
```

---

### 2. ุงูุฎุทุฃ: "Class 'Socialite' not found"

**ุงูุญู:**
```bash
composer require laravel/socialite
```

---

### 3. ุงูุฎุทุฃ: "SQLSTATE[23000]: Integrity constraint violation"

**ุงูุณุจุจ**: ุนููุฏ `google_id` ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
```bash
php artisan migrate:fresh
# ุฃู
php artisan migrate:rollback
php artisan migrate
```

---

### 4. ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุง ููุฑุณู

**ุงูุญู:**
```bash
# 1. ุชุญูู ูู ุฅุนุฏุงุฏุงุช .env
cat .env | grep MAIL

# 2. ุงูุณุญ ุงููุงุด
php artisan config:clear
php artisan cache:clear

# 3. ุชุฃูุฏ ูู ุชุดุบูู Queue worker ุฅุฐุง ููุช ุชุณุชุฎุฏู queue
php artisan queue:work

# 4. ุงูุญุต ุงูููู
tail -f storage/logs/laravel.log
```

---

### 5. ุงูุฎุทุฃ: "The redirect URI provided does not match"

**ุงูุณุจุจ**: `GOOGLE_REDIRECT_URL` ูู `.env` ูุง ูุทุงุจู Google Console

**ุงูุญู:**
1. ุงุฐูุจ ุฅูู: https://console.cloud.google.com/
2. ุงุฎุชุฑ ุงููุดุฑูุน
3. APIs & Services > Credentials
4. ุงุถุบุท ุนูู OAuth 2.0 Client ID
5. ุฃุถู `http://localhost:8000/auth/google/callback` ูู Authorized redirect URIs

---

## ุงุฎุชุจุงุฑ ุดุงูู (Checklist) โ

ูุจู ุงูุฅูุชุงุฌุ ุชุฃูุฏ ูู:

- [ ] ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ ุงููููุฐุฌ ูุนูู
- [ ] ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ Google ูุนูู
- [ ] ุฅุฑุณุงู ุจุฑูุฏ ูููุฏูุฑูู ูุนูู
- [ ] ุฅุฑุณุงู ุจุฑูุฏ ุชุฃููุฏ ูููุณุชุฎุฏู ูุนูู
- [ ] ุตูุญุฉ "ุทูุจู ููุฏ ุงููุฑุงุฌุนุฉ" ุชุธูุฑ ุจุดูู ุตุญูุญ
- [ ] ุงููุชุฌุฑ ูุธูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจู `is_approved = false`
- [ ] ุงููุชุฌุฑ ูุธูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจู `role = shop_owner`
- [ ] Google ID ูุชู ุญูุธู ุจุดูู ุตุญูุญ
- [ ] ุตูุฑุฉ Google Avatar ุชูุญูุธ ุจุดูู ุตุญูุญ
- [ ] ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุนูู
- [ ] ุงูุชุญููู ุงูุชููุงุฆู ุจูู ุงูุตูุญุงุช ูุนูู
- [ ] ุฑุณุงุฆู ุงูุฎุทุฃ ุชุธูุฑ ุจุดูู ุตุญูุญ

---

## ุฃูุงูุฑ ูููุฏุฉ ููุงุฎุชุจุงุฑ

```bash
# ุนุฑุถ ุฌููุน ุงููุชุงุฌุฑ ุงููุณุฌูุฉ
php artisan tinker
\App\Models\User::where('role', 'shop_owner')->get(['id', 'name', 'shop_name', 'email', 'is_approved']);

# ุญุฐู ูุชุฌุฑ ุชุฌุฑูุจู
\App\Models\User::where('email', 'test-shop@example.com')->delete();

# ุงูููุงููุฉ ุนูู ูุชุฌุฑ ูุฏููุงู
$shop = \App\Models\User::where('email', 'test-shop@example.com')->first();
$shop->is_approved = true;
$shop->save();

# ุนุฑุถ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฏูุฑ
$admin = \App\Models\User::where('role', 'admin')->first();
$admin->notifications;

# ูุณุญ ุฌููุน ุงูุฅุดุนุงุฑุงุช
$admin->notifications()->delete();

# ุชุดุบูู Queue worker (ุฅุฐุง ููุช ุชุณุชุฎุฏู queue ููุจุฑูุฏ)
php artisan queue:work

# ูุฑุงูุจุฉ ุงูููู ูุจุงุดุฑุฉ
tail -f storage/logs/laravel.log
```

---

## ุฎูุงุตุฉ

ุงูุขู ููููู ุงุฎุชุจุงุฑ:
1. โ ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ ุงููููุฐุฌ ุงูุชูููุฏู
2. โ ุชุณุฌูู ูุชุฌุฑ ุนุจุฑ Google OAuth
3. โ ุฅุฑุณุงู ุฑุณุงุฆู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุฏูุฑูู
4. โ ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฃููุฏ ุงูุจุฑูุฏ ูููุณุชุฎุฏู
5. โ ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

ุงุณุชุฎุฏู **Mailtrap** ููุชุทููุฑ ูุฃูู ุงูุฃูุถู ูุงูุฃุณูู! ๐ฏ